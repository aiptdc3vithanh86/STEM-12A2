<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8" />
  <title>Teachable Machine - Mốc 2</title>

  <script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs@4.10.0/dist/tf.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/@teachablemachine/image@0.8/dist/teachablemachine-image.min.js"></script>

  <style>
    body { text-align: center; font-family: Arial; }
    video {
      width: 280px;
      height: 280px;
      border: 4px solid #000;
      border-radius: 12px;
    }
    #result {
      font-size: 26px;
      color: red;
      font-weight: bold;
      margin-top: 12px;
    }
  </style>
</head>

<body>
  <h2>Nhận diện Teachable Machine</h2>

  <button onclick="startCamera()">Bật camera</button>

  <br><br>
  <video id="video" autoplay playsinline></video>

  <div id="result"></div>

<script>
  const URL = "model/";   // thư mục model
  let model;
  let video = document.getElementById("video");
  let resultDiv = document.getElementById("result");

  async function loadModel() {
    model = await tmImage.load(
      URL + "model.json",
      URL + "metadata.json"
    );
    console.log("Model loaded");
  }

  async function startCamera() {
    await loadModel();

    const constraints = {
      video: {
        facingMode: { ideal: "environment" } // ưu tiên cam sau
      }
    };

    const stream = await navigator.mediaDevices.getUserMedia(constraints);
    video.srcObject = stream;

    requestAnimationFrame(loop);
  }

  async function loop() {
    await predict();
    requestAnimationFrame(loop);
  }

  async function predict() {
    const prediction = await model.predict(video);

    for (let p of prediction) {
      if (p.className === "mat" && p.probability > 0.9) {
        resultDiv.innerText = "ĐÂY LÀ ÁI";
        return;
      }
    }
    resultDiv.innerText = "";
  }
</script>
</body>
</html>
